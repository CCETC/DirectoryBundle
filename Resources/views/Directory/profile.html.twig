{% extends layoutTemplate %}

{% block page_header %}
    <div class="page-btns">
        <a href="{{ app.session.get('lastListingsUri')? app.session.get('lastListingsUri') : path('listings') }}" class="btn pull-left"><i class="icon-arrow-left"></i> Back to {{ (listingType.translationKey ~ "s")|capitalize|trans({}, "messages") }}</a>
        <div class="btn-group pull-right">
            <a class="btn" href="javascript:if(window.print)window.print()" ><i class="icon-print"></i> Print</a> 
            {% if is_granted("ROLE_ADMIN") %}
                <a class="btn edit-btn" href="{{ listingAdmin.generateObjectUrl('edit', listing) }}" ><i class="icon-pencil"></i> Edit</a> 
            {% elseif app.user.listing.id is defined and app.user.listing.id == listing.id %}
                <a class="btn edit-btn" href="{{ path(listingType.editRouteName, {'id' : listing.id}) }}" ><i class="icon-pencil"></i> Edit</a> 
            {% endif %}
        </div>
        <div style="clear: both; line-height: 0px;">&nbsp;</div>
    </div>
{% endblock %}

{% block content %}
        
    {% if listing.location.lat is defined and listing.location.lat != "" and listing.location.lng is defined and listing.location.lng != "" %}
        <script type="text/javascript">
            {% include 'CCETCDirectoryBundle:Directory:_profile_marker_object.js.twig' %}
                
            $(document).ready(function() {
                profileMapInit();
            });
        </script>
    {% endif %}

    {% if listing.status == "new" and (userOwnsListing or is_granted('ROLE_ADMIN')) %}
        <div class="alert alert-notice">
            {% if listing.user is defined and listing.user == app.user %}
                <h3>Note: your listing has not been approved yet.</h3>
            {% else %}
                <h3>Note: this listing has not been approved yet.</h3>
                <a class="btn btn-success" href="{{ listingType.adminClass.generateUrl('update-status', {'id' : listing.id, 'status' : 'active'}) }}" ><i class="icon-check icon-white"></i> Approve</a> 
                <a class="btn btn-danger" href="{{ listingType.adminClass.generateUrl('update-status', {'id' : listing.id, 'status' : 'spam'}) }}" ><i class="icon-remove icon-white"></i> Spam</a> 
            {% endif %}
        </div>
    {% endif %}
    {% if listing.status == "edited" and (userOwnsListing or is_granted('ROLE_ADMIN')) %}
        <div class="alert alert-notice">
            {% if listing.user is defined and listing.user == app.user %}
                <h3>Note: your recent changes have not been approved yet.</h3>
                <h4>You can view them below, but others will see the old version until your changes are approved.</h4>
            {% else %}
                <h3>Note: this listing has changes that have not been approved yet.</h3>
                <h4>The updated version is displayed below.</h4><br/>
                <a class="btn btn-success" href="{{ listingType.adminClass.generateUrl('update-status', {'id' : listing.id, 'status' : 'active'}) }}" ><i class="icon-check icon-white"></i> Approve</a>  
            {% endif %}
        </div>
    {% endif %}

    {% if listing.status == "edited" and not userOwnsListing and not is_granted('ROLE_ADMIN') %}
        {{ listing.savedProfileContentHtml|raw }}
    {% else %}
        {% include profileContentTemplate %}
    {% endif %}

{% endblock %}